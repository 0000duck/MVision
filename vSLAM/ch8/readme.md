# 直接法系列

# 特征点法的缺点
      1、关键点的提取与描述子的计算非常耗时。
         实践当中，SIFT目前在CPU上是无法实时计算的，而ORB也需要近20毫秒的计算。
         如果整个SLAM以30毫秒/帧的速度运行，那么一大半时间都花在计算特征点上。
      2、使用特征点时，忽略了除特征点以外的所有信息。
         一张图像有几十万个像素，而特征点只有几百个。
         只使用特征点丢弃了大部分可能有用的图像信息。
      3、相机有时会运动到特征缺失的地方，往往这些地方都没有什么明显的纹理信息。
         例如，有时我们会面对一堵白墙，或者一个空荡荡的走廓。
         这些场景下特征点数量会明显减少，我们可能找不到足够的匹配点来计算相机运动。


# 特征点-光流法
      只计算关键点，不计算描述子。
      同时，使用光流法（Optical Flow）来跟踪特征点的运动。
      这样可以回避计算和匹配描述子带来的时间，但光流本身的计算需要一定时间；
      
      仍然使用特征点，只是把匹配描述子替换成了光流跟踪，
      估计相机运动时仍使用 RANSCK + PnP或ICP算法。
      后面也可以使用BA进行优化。
      
# 特征点(梯度大的点)-直接法(投影后的测量误差)
      只计算关键点，不计算描述子/计算关键点、也不计算描述子(梯度大小选择关键点)。
      同时，使用直接法来计算特征点在下一时刻图像的位置。
      这同样可以跳过描述子的计算过程，而且直接法的计算更加简单。
      
      直接法估计相机运动，有已知的3d点，投影到两幅图像上，像素值应该没有变化(假设)
      实际上会有误差，
      ei=I1(p1,i)−I2(p2,i)，
      p1 = 1/z1*K*P   
      p2 = 1/z2*K*(R*P+t)   
      
      对误差e求优化变量的偏导数，可以得到优化变量的更新量。使用LM/GN算法优化
      
# 直接法的使用
      P 是一个已知位置的空间点，它是怎么来的呢？
      在RGB-D相机下，我们使用深度信息可以把任意像素反投影到三维空间，然后投影到下一个图像中。
      如果在单目相机中，我们也可以使用 一个估计的深度，来缺点特征点对应的3d点
      （虽然是特征点(也可以是灰度梯度大的点)，但直接法里是可以避免计算描述子的）。

      根据P的来源，我们可以把直接法进行分类：

      1、P来自于稀疏特征点，我们称之为稀疏直接法。
         通常我们使用数百个特征点，并且会像L-K光流那样，假设它周围像素也是不变的。
         这种稀疏直接法速度不必计算描述子，并且只使用数百个像素，因此速度最快，但只能计算稀疏的重构。
      2、P来自部分像素。我们看到 对误差e求优化变量的偏导数 中，如果像素梯度为零，整一项雅可比就为零，
         不会对计算运动增量有任何贡献。因此，可以考虑只使用带有梯度的像素点，舍弃像素梯度不明显的地方。
         这称之为半稠密（Semi-Dense）的直接法，可以重构一个半稠密结构。
      3、P为所有像素，称为稠密直接法。
         稠密重构需要计算所有像素（一般几十万至几百万个），
         因此多数不能在现有的 CPU上实时计算，需要GPU的加速。

# 直接特征点法对比法与
      相比于特征点法，直接法完全依靠像优化来求解相机位姿。
![](https://images2015.cnblogs.com/blog/606958/201607/606958-20160720225237060-1994588212.png)



