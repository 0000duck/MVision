# DSO  Direct Sparse Odometry 一种基于直接法，构建稀疏点云地图的视觉里程计
[代码](https://github.com/Ewenwan/dso)

[原理参考](https://blog.csdn.net/u012986684/article/details/78015094)

[安装](https://github.com/Ewenwan/MVision/blob/master/vSLAM/dso_slam/install.md)

    
    DSO属于稀疏直接法的视觉里程计。它不是完整的SLAM，因为它不包含回环检测、地图复用的功能。
    因此，它不可避免地会出现累计误差，尽管很小，但不能消除。
    
    DSO (Direct sparse odometry) [24] 系统基于直接法的拓展 , 
    使用光度值误差最小化几何和光度学参数.
    DSO 对图像中有梯度、边缘或亮度平滑变化.
# 1. DSO 概述
## 前端 追踪
    DSO甚至没有“匹配点”这个概念。
    每一个三维点，从某个主导帧（host frame）出发，乘上深度值之后投影至另一个目标帧（target frame），从而建立一个投影残差（residual）。
    只要残差在合理范围内，就可以认为这些点是由同一个点投影的。
    从数据关联角度看，在这个过程中并没有a1-b1, a2-b2这样的关系，也可能存在a1-b1, a2-b1, a3-b1这样的情况。
    但是DSO并不在意这些，只要残差不大，我们就看成是同一个点。这是很重要的一点。
    在特征点法中，我们可以找到一个地图点分别在哪些帧中被看到，乃至找到各帧中的图像描述子是什么；
    但在DSO中，我们会尝试把 每个点 投影到 所有帧 中，计算它在各帧中的残差，而并不在意点和点之间的一一对应关系。
## 后端 优化
    从后端来看，DSO使用一个由若干个关键帧组成的滑动窗口作为它的后端。
    这个窗口在整个VO过程中一直存在，并有一套方法来管理新数据的加入以及老数据的去除。
    具体来说，这个窗口通常保持5到7个关键帧。
    前端追踪部分，会通过一定的条件，来判断新来的帧是否可作为新的关键帧插入后端。
    同时，如果后端发现关键帧数已经大于窗口大小，也会通过特定的方法，选择其中一个帧进行去除。
    请注意被去除的帧并不一定是时间线上最旧的那个帧，而是会有一些复杂条件的。
### 优化参数 海塞矩阵和b
    后端除了维护这个窗口中的关键帧与地图点外，还会维护与优化相关的结构。
    特别地，这里指Gauss-Newton或Levenburg-Marquardt方法中的Hessian矩阵和b向量（仅先验部分）。
    当我们增加新的关键帧时，就必须扩展H和b的维度；
    反之，如果需要去掉某个关键帧（以及它携带的地图点）时，也需要降低H和b的维度。
    这个过程还需要将被删掉帧和点的信息，转移到窗口内剩余帧当中，这一步被称为边缘化（Marginalization）。

## 光度标定 仿射变换
    由于直接法需要比较图像信息，其结果容易受光照干扰。
    于是，DSO提出了光度标定，认为对相机的曝光时间、暗角、伽马响应等参数进行标定后，能够让直接法更加鲁棒。
    对于未进行光度标定的相机，DSO也会在优化中动态估计 光度参数（具体来说，是一个仿射变化的参数，记作a和b）。
    这个过程建模了相机的成像过程，因此对于由相机曝光不同引起的图像明暗变化，会有更好的表现。
    但是，如果由于环境光源发生变化，光度标定也是无能为力的。
    
# 与其他直接法的不同：

    1. 将光度模型、集合模型结合起来，对相机内参、相机姿态、像素点的深度等参数做联合估计；
    2. 由于引入了光度模型，算法忽略了其他直接法采用的对图像进行平滑的预处理，
       而是将相机看做一个传感器，对图像像素进行均匀采样，进行计算。
    3. 提出的模型集成了完整的光度校准，考虑了曝光时间、透镜渐晕和非线性相应函数。
    4. 通过实验验证，该算法在跟踪精度和鲁棒性方面性能超过了state-of-the-art的算法水平。
    
# 2. 系统 框架流程

    2.1 代码框架与数据表示 
![](https://pic3.zhimg.com/80/v2-6a9dcd379ce3c772e8e14aeae09b6e0a_hd.jpg)



